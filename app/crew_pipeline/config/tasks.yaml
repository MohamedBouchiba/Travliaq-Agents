tasks:
  traveller_profile_brief:
    agent: traveller_insights_analyst
    description: |-
      Analyse attentivement le questionnaire client et l'inférence persona existante
      (déjà calculée par un service amont — ne la recalculer pas, utilise-la comme
      contexte fiable).

      QUESTIONNAIRE BRUT:
      {questionnaire}

      INFÉRENCE PERSONA FOURNIE:
      {persona_context}

      Ton objectif est de comprendre les motivations, priorités et contraintes
      du voyageur. Produit un raisonnement explicite: identifie les éléments
      positifs (pour), les points de vigilance (contre), les besoins critiques,
      les préférences non critiques et les objectifs implicites. Termine par un
      paragraphe narratif immersif qui décrit la personne comme si tu la
      présentais à un travel designer.
    expected_output: |-
      Réponds STRICTEMENT en JSON suivant la structure ci-dessous. Utilise des
      phrases complètes et précises.
      {
        "persona_summary": "Résumé synthétique du profil",
        "pros": ["Liste des points favorables"],
        "cons": ["Liste des risques ou points d'attention"],
        "critical_needs": ["Besoins indispensables"],
        "non_critical_preferences": ["Envies confort mais non bloquantes"],
        "user_goals": ["Objectifs explicites ou implicites"],
        "narrative": "Paragraphe narratif en français",
        "analysis_notes": "Synthèse de ta réflexion"
      }
    async_execution: false
  persona_challenge_review:
    agent: persona_quality_challenger
    context:
      - traveller_profile_brief
    description: |-
      Tu es le relecteur critique de l'analyse précédente. Exploite le contexte
      pour évaluer la solidité du raisonnement, détecter les contradictions avec
      le questionnaire et ajouter les recommandations qui manquent pour
      opérationnaliser la proposition.

      1. Challenge l'argumentation: signale les hypothèses fragiles ou les biais
         et propose des correctifs précis.
      2. Vérifie que les pros/cons/besoins/goals sont complets et aligne-les avec
         les signaux forts du questionnaire.
      3. Termine par une synthèse actionnable expliquant quoi transmettre à un
         travel designer.

      La restitution finale DOIT respecter le même schéma JSON que la première
      tâche en y ajoutant un bloc dédié à ton challenge.
    expected_output: |-
      {
        "persona_summary": "Résumé mis à jour après challenge",
        "pros": ["Liste consolidée"],
        "cons": ["Liste consolidée"],
        "critical_needs": ["Besoins confirmés"],
        "non_critical_preferences": ["Préférences"],
        "user_goals": ["Objectifs"],
        "narrative": "Récit affiné",
        "analysis_notes": "Synthèse complète",
        "challenge_summary": "Ce que ton challenge a apporté",
        "challenge_actions": ["Actions concrètes à transmettre"]
      }
    async_execution: false
